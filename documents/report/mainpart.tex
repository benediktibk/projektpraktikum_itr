
%_________Mainpart__________________________________

\chapter{System Identification}
\label{chap:system_identification}

The target of the system identification is to estimate the kinematics of the object, which are:
\begin{enumerate}
	\item mass $m$
	\item center of gravity, represented through the offset $\vec c$ from the grasping point to the center of gravity
	\item inertia matrix $\vec I_\scr{q}$, with respect to the center of gravity
\end{enumerate}

For simplicity we will first discuss the problem of the identification of the object kinematics with only one grasping point. Starting from these formulas, we will then continue with multiple grasping points, which is the case for cooperative identification.

\section{One Grasping Point}
\label{sec:one_grasping_point}

\begin{figure}
	\centering
	\include{tikz/load_one_grasping_point}
	\caption{Load with one grasping point}
	\label{fig:load_one_grasping_point}
\end{figure}

The system behaviour of a model like \ref{fig:load_one_grasping_point} can be described through 
\begin{equation}
	^\scr{L}\vec{F} = m {^\scr{W}}\vec{\ddot{p}} + m ^\scr{L}\vec{g} + ^\scr{L}\vec{\dot{\omega}} \times m ^\scr{L}\vec{c} + ^\scr{L}\vec{\omega} \times (^\scr{L}\vec{\omega} \times m ^\scr{L}\vec{c}),
	\label{eq:force}
\end{equation}
which is derived from the conservation of momentum, and
\begin{equation}
	^\scr{L}\vec{N} = ^\scr{L}\vec{I}_\scr{p} ^\scr{L}\vec{\dot{\omega}} + ^\scr{L}\vec{\omega} \times (^\scr{L}\vec{I}_\scr{p} ^\scr{L}\vec{\omega}) + m ^\scr{L}\vec{c} \times {^\scr{W}}\vec{\ddot{p}} + m ^\scr{L}\vec{c} \times ^\scr{L}\vec{g},
	\label{eq:torque}
\end{equation}
which comes from the conservation of angular momentum. Both formulas are taken from \ref{MISSING}, but are used here with a different definition of the gravity vector. Throughout this paper we assume that in the world coordinate frame $\vec g$ only has a component in the $z$-direction, with a negative value.

The inertia matrix $\vec I_\scr{p}$ in these formulas represents the inertia of the object transformed into the grasping point through the parallel axis theorem
\begin{equation}
	\vec I_\scr{p} = \vec I_\scr{q} + m \left( (\vec c^\scr{T} \vec c) \vec 1 - (\vec c \vec c^\scr{T}) \right).
\end{equation}
All values, besides the position of the object $\vec p$, are represented in the load frame, as for instance the angular velocity $\vec \omega$ of the endeffector. This value can be calculated as the derivative with respect to time of the orientation $^W\vec{\varphi}$ of the load coordinate frame in the world coordinate frame:
\begin{equation}
	{^\scr{W}}\vec{\omega} = \frac{\partial {^\scr{W}}\vec{\varphi}}{\partial t}
\end{equation}
For use in the estimator this value needs to be transformed into the load coordinate frame, which means that the rotation
\begin{equation}
	^\scr{L}\vec{\omega} = \vec{R}({^\scr{W}}\vec{\varphi}) {^\scr{W}}\vec{\omega}
\end{equation}
must be applied. For the graviation, which changes its direction in the load coordinate frame with the rotation of the object, the same rotation is necessary. For the sake of legibility we will not denote the coordinate frames anymore during the rest of this section.

In the case of only one grasping point we then have in total ten unknowns:
\begin{enumerate}
	\item mass $m$
	\item grasping point offset from the center of gravity $\vec c = [c_x, c_y, c_z]^\scr{T}$ with three unknowns
	\item inertia matrix with six unknowns, as this matrix is by definition symmetric
	\begin{equation}
		\vec{I}_\scr{p} = 
		\begin{bmatrix}	
			I_{xx}	& I_{xy}	& I_{xz} \\
			I_{xy}	& I_{yy}	& I_{yz} \\
			I_{xz}	& I_{yz}	& I_{zz}
		\end{bmatrix}
	\end{equation}
\end{enumerate}

These values are combined to the system parameter vector
\begin{equation}
	\vec{\Theta} = [m, m c_x, m c_y, m c_z, I_{xx}, I_{xy}, I_{xz}, I_{yy},I_{yz}, I_{zz}]^\scr{T},
\end{equation}
where in practice we do not know the correct values, but instead only the estimation $\vec{\hat \Theta}$.

For the estimator as input information we have a vector filled with the forces and torques at the grasping point
\begin{equation}
	\vec{h} = [F_x, F_y, F_z, M_x, M_y, M_z]^\scr{T},
\end{equation}
the position of the grasping point $\vec p$, the angular velocity $\vec \omega$ of the grasping point and the gravity $\vec g$. For a recursive least squares estimation we need now the linear relation
\begin{equation}
	\vec{h}(k) = \vec{\Phi}(k) \vec{\Theta}(k)
\end{equation}
between $\vec{\Theta}$ and $\vec{h}$ with
\begin{equation}
	\vec{\Phi}(k) = 
	\begin{bmatrix}
		\vec{\ddot p} - \vec{g}	& [\vec{\dot \omega} \times] + [\vec{\omega}\times] [\vec{\omega} \times]	& 0 \\
		0			& [(\vec{g} - \vec{\ddot p}) \times]									& [.  \vec{\dot \omega}] + [\vec{\omega} \times] [. \vec{\omega}]
	\end{bmatrix},
\end{equation}
which was derived in \ref{MISSING}.

The recursive least squares is then an iterative improvement of the estimation, where for every sampling step the formulas
\begin{equation}
	\vec{K}(k) = \vec{P}(k-1) \vec{\Phi}^\scr{T}(k) (\vec{I} + \vec{\Phi}(k) \vec{P}(k - 1) \vec{\Phi}^\scr{T}(k))^{-1}
\end{equation}
\begin{equation}
	\vec{P}(k) = (\vec{I} - \vec{K}(k) \vec{\Phi}(k)) \vec{P}(k - 1)
\end{equation}
\begin{equation}
	\vec{\hat \Theta}(k)=\vec{ \hat \Theta}(k - 1) + \vec{K}(k) (\vec{h}(k) - \vec{\Phi}(k) \vec{\hat \Theta}(k - 1))
\end{equation}
are applied \ref{MISSING}. The initialization of the algorithm can be done through
\begin{equation}
	\vec{P}(k_0) = \left( \vec{\Phi}^\scr{T}(k_0) \vec{\Phi}(k_0) \right)^{-1}
\end{equation}
and
\begin{equation}
	\vec{\hat \Theta} (k_0) = \vec{P}(k_0) \vec{\Phi}^\scr{T}(k_0) \vec{h}(k_0).
\end{equation}

\section{Multiple Grasping Points}

\begin{figure}
	\centering
	\include{tikz/load_multiple_grasping_points}
	\caption{Load with multiple grasping points}
	\label{fig:load_multiple_grasping_points}
\end{figure}

Of course a load can also be hold by multiple manipulators, or arms in case of a human. As long as on every grasping point a force and torque sensor is mounted the basic principle of the previous section can be reused for the load estimation. In this case the forces and torques are distributed over all grippers, whereas the distribution depends on the reactive forces of the manipulators. Therefore, the only difference in the physics is that $n$ forces and torques are combined on the left hand sides of
\begin{equation}
	\sum_{i = 1}^{n}  {^\scr{L}}\vec{F}_{i} = m {^\scr{W}}\vec{\ddot{p}} + m {^\scr{L}}\vec{g} + {^\scr{L}}\vec{\dot{\omega}} \times m {^\scr{L}}\vec{c} + {^\scr{L}}\vec{\omega} \times ({^\scr{L}}\vec{\omega} \times m {^\scr{L}}\vec{c})
	\label{eq:force_multiple}	
\end{equation}
and
\begin{equation}
	\sum_{i = 1}^n {^\scr{L}}\vec{N}_{i} + \sum_{i = 2}^n {^\scr{L}}\vec{r}_{i} \times {^\scr{L}}\vec{F}_{i} = {^\scr{L}}\vec{I}_\scr{p} {^\scr{L}}\vec{\dot{\omega}} + {^\scr{L}}\vec{\omega} \times ({^\scr{L}}\vec{I}_\scr{p} {^\scr{L}}\vec{\omega}) + m {^\scr{L}}\vec{c} \times {^\scr{W}}\vec{\ddot{p}} + m {^\scr{L}}\vec{c} \times {^\scr{L}}\vec{g}.
	\label{eq:torque_multiple}	
\end{equation}
The additional summands for the torques are caused by the forces which are not applied in the grasping point one. Implicitly for these formulas we assume that the load coordinate system has its origin in the grasping point of gripper one and that the offsets ${^\scr{L}}\vec{r}_{i}$ from this gripper to the gripper $i$ are known. Additonally, we have again denoted the corresping coordinate systems, but we won't repeat this during the rest of the section for more legible formulas.

At this point nearly the same iterative steps can be applied to estimate the load kinematics. The difference lies here within the calculation of $\vec{h}$, which is in this case not only the combination of the forces and torques to a vector, but instead has to consider the total sums of forces, torques and torques caused by the forces. The total forces and torques can be taken from \ref{eq:force_multiple} and \ref{eq:torque_multiple}, which leads us to
\begin{equation}
	\vec{h} = 
	\begin{bmatrix}
		\sum_{i = 1}^n {^\scr{L}}\vec{F}_{i} \\
		\sum_{i = 1}^n {^\scr{L}}\vec{N}_{i} + \sum_{i = 2}^n {^\scr{L}}\vec{r}_{i} \times {^\scr{L}}\vec{F}_{i}
	\end{bmatrix}
\end{equation}

The rest of the recursive least squares is than the same as in \ref{chap:system_identification}.